---
title: "AEMO Analysis"
author: "Oliver Sheridan-Methven"
date: "10/17/2017"
output: 
    pdf_document: 
        fig_caption: yes
---


# Abstract 

In this report we investigate the relationship between electricity prices
and daytime tmemperatures in Sydney Australia during 2013. We build a
second order non-linear model based on the minimum daytime temperature,
and predict the prices for the first week in January. This model is able to 
capture weekend and weekday differences.

# The Raw Data

The data available is the RRP (the electricity price), and the daily 
maximum and minimum temperature values:

```{r, echo=FALSE}
library(plyr)
# Reading in the data:
AEMO <- read.csv("AEMOPriceDataSimple.csv")
SydTemp <- read.csv("SydTemp.csv")
minTemp <- SydTemp$Minimum.temperature..Degree.C.
maxTemp <- SydTemp$Maximum.temperature..Degree.C.
maxTemp <- maxTemp[SydTemp$Year == 2013]
minTemp <- minTemp[SydTemp$Year == 2013]
maxTemp <- maxTemp[!is.na(maxTemp)]
minTemp <- minTemp[!is.na(minTemp)]

Date <- as.Date(AEMO$Date, '%d/%m/%y')
AEMO <- subset(AEMO, select = c("RRP"))
AEMO <- cbind(AEMO, Date)

SydTemp <-
cbind(SydTemp, Date = as.Date(ISOdate(SydTemp$Year, SydTemp$Month, SydTemp$Day)))

df <- na.omit(merge(AEMO, SydTemp, by.x = "Date", by.y = "Date"))
df <- rename(df, c("Maximum.temperature..Degree.C."="temp_max","Minimum.temperature..Degree.C."="temp_min"))
df <- subset(df, select = c("temp_max", "temp_min", "Date", 'RRP'))
head(df)
```

## Outliers

There is a notable outlier in the electricty prices for 20^th^ December 2013, 
(caused by an electrical storm). Due to the esoteric nature of such an event,
we do not want to consider such a point for use in everyday price predictions, 
so we exlude this from our considerations. The resultant dependence between the 
electricity prices and the minimum daily temperature is shown in  Figure \ref{fig:fig_prices_max_temp}. 

```{r, echo=FALSE, include=FALSE}
# we notice this has an obvious outlier in December
df[df$RRP > 200, ]
# we see this corresponds to the large electrical storm on 20th December 2013, so will delete
# this from our dataset.
df <- df[df$RRP < 200, ]
plot(df$Date, df$RRP, xlab = "Date", ylab = "RRP", title("Electricity Prices"))
# We notice that this perhaps looks a little buldge in Australia's Winter months (May-September)
summary(df$RRP)
```

```{r fig_prices_max_temp, echo=FALSE, fig.cap="\\label{fig:fig_prices_max_temp}The dependence on the electricity prices with variations in the daily temperature minimum."}
plot(df$temp_min, df$RRP, xlab = "Max Temp (C)", ylab = "RRP", title("Electricity Prices"))
```

# Non-linear temperature effects 

We recall the linear model
$$
Y = X\beta + \epsilon.
$$

To assess whether non-linear temperature effects are significant, we fit a 
linear model and a second order polynomial model to the data. We find the 
linear model has the $p$-value:

```{r, echo=FALSE}
# Pulling out the p_value
linearModel <- lm(df$RRP~df$temp_min)
anova(linearModel)$'Pr(>F)'[1]
```
which is significant. Furthermore, trying a higher order non-linear model
with quadratic terms achieves a $p$-value of:
```{r, echo=FALSE}
nonlinearModel <- lm(df$RRP~df$temp_min + I(df$temp_min^2))
coef(summary(nonlinearModel))[, "Pr(>|t|)"]
```
We can see these p-values are less than 0.05, and so we believe they are 
statistically significant to a 95% confidence level (approximately a $2\sigma$ 
confidence). 


# Building model matrices

We can build model matrices using the following R-function: 

```{r}
pieLinear <- function(x, k) {
    # Produces a model matrix for linear models using knots.
    positive <- function(x) {
        # Replaces negative values with zeros.
        x[x < 0] <- 0
        return(x)
    }
    modelMatrix <- matrix(c(x))
    for (i in 1:length(k)) {
        modelMatrix <- cbind(modelMatrix, positive(x - k[i]))
    }
    return(modelMatrix)
}
```

Which when given $x = (1,2,\dots,10)$ and knot points $(2,6)$ will output the
model matrix:

```{r}
x <- 1:10
knots <- c(2, 6)
X <- pieLinear(x, knots)
print(X)
```

